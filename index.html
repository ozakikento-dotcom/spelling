<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Spelling Dragon Battle</title>

<style>
body{
  font-family: Arial, sans-serif;
  background:#e6f7ff;
  text-align:center;
  margin:0;
  padding:10px;
}
h1{color:#2b6cb0;}
.level{font-size:22px;margin:5px;}
.dragon{font-size:80px;}

.listen-btn{
  font-size:34px;
  padding:22px 45px;
  margin:10px;
  border-radius:25px;
  background:#ff9800;
  color:white;
  border:none;
}
.listen-btn:active{background:#f57c00;}

.hint-btn{
  font-size:28px;
  padding:18px 30px;
  margin:10px;
  border-radius:22px;
  background:#9c27b0;
  color:white;
  border:none;
}
.hint-btn:active{background:#7b1fa2;}

.hp-bar{
  width:260px;height:20px;
  background:#ddd;border-radius:10px;
  margin:8px auto;overflow:hidden;
}
#hpFill{
  height:100%;
  background:linear-gradient(to right,#4caf50,#8bc34a);
  width:0%;transition:.3s;
}

#hint{
  font-size:34px;
  height:40px;
  color:#444;
}

.progress{
  font-size:30px;
  color:green;
  min-height:36px;
}

.buttons button{
  font-size:40px;
  width:95px;
  height:95px;
  margin:8px;
  border-radius:22px;
  border:none;
  background:#4cafef;
  color:white;
}
.buttons button:active{background:#2196f3;}

#stickerArea{
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:8px;
  margin-top:10px;
}
#stickerArea img{
  width:60px;
  border-radius:8px;
  box-shadow:0 2px 4px rgba(0,0,0,.2);
}

/* æ‹¡å¤§ */
#modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.7);
  justify-content:center;
  align-items:center;
  z-index:2000;
}
#modal img{
  width:300px;
  background:white;
  border-radius:20px;
  padding:10px;
}

/* ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—æ¼”å‡º */
#levelUpEffect{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(255,255,255,0.9);
  z-index:5000;
  justify-content:center;
  align-items:center;
  flex-direction:column;
}
.level-text{
  font-size:48px;
  color:#ff9800;
  font-weight:bold;
  animation:pop .6s ease-out;
}
@keyframes pop{
  0%{transform:scale(.5);opacity:0;}
  100%{transform:scale(1);opacity:1;}
}
.sparkles{
  font-size:36px;
  animation:sparkle 1.2s linear infinite;
}
@keyframes sparkle{
  0%{opacity:0;transform:translateY(10px);}
  50%{opacity:1;}
  100%{opacity:0;transform:translateY(-20px);}
}

/* è¦ªç”»é¢ */
#parentPanel{
  display:none;
  position:fixed;
  inset:0;
  background:#fff;
  z-index:4000;
  padding:20px;
  text-align:left;
}
#parentTrigger{
  position:fixed;
  bottom:0;left:0;
  width:100%;height:40px;
}
</style>
</head>

<body>

<h1>ğŸ‰ ã‚¹ãƒšãƒªãƒ³ã‚° ãƒ‰ãƒ©ã‚´ãƒ³ãƒãƒˆãƒ«</h1>
<div class="level">LEVEL <span id="level">1</span></div>
<div class="dragon">ğŸ²</div>

<div class="hp-bar"><div id="hpFill"></div></div>

<button class="listen-btn" onclick="speakWord()">ğŸ”Š ãã</button>
<button class="hint-btn" onclick="showHint()">ğŸ’¡ HINT</button>

<div id="hint"></div>
<div class="progress" id="progress"></div>
<div class="buttons" id="buttons"></div>

<h3>ğŸ ã‚¹ãƒ†ãƒƒã‚«ãƒ¼</h3>
<div id="stickerArea"></div>

<!-- æ‹¡å¤§ -->
<div id="modal" onclick="closeModal()">
  <img id="modalImg">
</div>

<!-- ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ— -->
<div id="levelUpEffect">
  <div class="level-text">LEVEL UP!! â­</div>
  <div class="sparkles">âœ¨ â­ âœ¨ â­ âœ¨</div>
</div>

<!-- è¦ª -->
<div id="parentTrigger"></div>
<div id="parentPanel">
  <h2>ğŸ”§ ä¿è­·è€…ç”¨</h2>
  <p>ãƒ¬ãƒ™ãƒ«ï¼š<b id="pLevel"></b></p>
  <p>ãƒ—ãƒ¬ã‚¤å›æ•°ï¼š<b id="pTotal"></b></p>
  <button onclick="resetAll()">ãƒªã‚»ãƒƒãƒˆ</button>
  <button onclick="closeParent()">ã¨ã˜ã‚‹</button>
</div>

<script>
/* ===== å˜èª ===== */
let words=[
 "the","said","come","love","find","go","here","there","why",
 "children","climb","busy","people","beautiful","after",
 "could","would","should","who","every"
].map(w=>w.toUpperCase());

let level=1,totalCount=0;
let levelWords=[],qIndex=0;
let currentWord="",charIndex=0;
let stickers=[];

/* ===== éŸ³ ===== */
function speakWord(){
  speechSynthesis.cancel();
  const u=new SpeechSynthesisUtterance(currentWord);
  u.lang="en-US";u.rate=0.9;
  speechSynthesis.speak(u);
}

/* ===== HINT ===== */
function showHint(){
  const h=document.getElementById("hint");
  h.textContent=currentWord;
  setTimeout(()=>h.textContent="",1000);
}

/* ===== ãƒ¬ãƒ™ãƒ«é–‹å§‹ ===== */
function startLevel(){
  levelWords=[...words].sort(()=>Math.random()-0.5).slice(0,10);
  qIndex=0;
  startQuestion();
}

/* ===== 1å• ===== */
function startQuestion(){
  currentWord=levelWords[qIndex];
  charIndex=0;
  document.getElementById("progress").textContent="";
  updateProgress();
  createButtons();
  setTimeout(speakWord,500);
}

/* ===== ãƒœã‚¿ãƒ³ ===== */
function createButtons(){
  const area=document.getElementById("buttons");
  area.innerHTML="";
  let letters=currentWord.split("");
  while(letters.length<8){
    const c=String.fromCharCode(65+Math.floor(Math.random()*26));
    if(!letters.includes(c)) letters.push(c);
  }
  letters.sort(()=>Math.random()-0.5);
  letters.forEach(l=>{
    const b=document.createElement("button");
    b.textContent=l;
    b.onclick=()=>tapLetter(l);
    area.appendChild(b);
  });
}

function tapLetter(l){
  if(l===currentWord[charIndex]){
    charIndex++;
    document.getElementById("progress").textContent=
      currentWord.slice(0,charIndex);
    if(charIndex===currentWord.length){
      totalCount++;
      qIndex++;
      updateProgress();
      if(qIndex>=10) levelUp();
      else startQuestion();
    }
  }
  saveGame();
}

/* ===== é€²æ— ===== */
function updateProgress(){
  document.getElementById("hpFill").style.width=(qIndex/10*100)+"%";
}

/* ===== ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ— ===== */
function playLevelUpSound(){
  const ctx=new (window.AudioContext||window.webkitAudioContext)();
  const o=ctx.createOscillator();
  const g=ctx.createGain();
  o.frequency.setValueAtTime(880,ctx.currentTime);
  o.frequency.exponentialRampToValueAtTime(1320,ctx.currentTime+.3);
  g.gain.setValueAtTime(.3,ctx.currentTime);
  g.gain.exponentialRampToValueAtTime(.001,ctx.currentTime+.6);
  o.connect(g);g.connect(ctx.destination);
  o.start();o.stop(ctx.currentTime+.6);
}

function showLevelUpEffect(){
  const e=document.getElementById("levelUpEffect");
  e.style.display="flex";
  playLevelUpSound();
  setTimeout(()=>e.style.display="none",1500);
}

function levelUp(){
  level++;
  document.getElementById("level").textContent=level;
  showLevelUpEffect();
  addSticker(Math.floor(Math.random()*50)+1);
  setTimeout(startLevel,1500);
}

/* ===== ã‚¹ãƒ†ãƒƒã‚«ãƒ¼ ===== */
function addSticker(n){
  stickers.push(n);
  const img=document.createElement("img");
  img.src=`volst (${n}).png`;
  img.onclick=()=>openModal(img.src);
  document.getElementById("stickerArea").appendChild(img);
  saveGame();
}
function openModal(src){
  document.getElementById("modalImg").src=src;
  document.getElementById("modal").style.display="flex";
}
function closeModal(){
  document.getElementById("modal").style.display="none";
}

/* ===== ä¿å­˜ ===== */
function saveGame(){
  localStorage.setItem("saveData",JSON.stringify({
    level,totalCount,stickers
  }));
}
function loadGame(){
  const d=JSON.parse(localStorage.getItem("saveData"));
  if(!d) return;
  level=d.level||1;
  totalCount=d.totalCount||0;
  stickers=d.stickers||[];
  document.getElementById("level").textContent=level;
  stickers.forEach(n=>{
    const img=document.createElement("img");
    img.src=`volst (${n}).png`;
    img.onclick=()=>openModal(img.src);
    document.getElementById("stickerArea").appendChild(img);
  });
}

/* ===== è¦ª ===== */
let timer;
document.getElementById("parentTrigger").ontouchstart=()=>{
  timer=setTimeout(openParent,5000);
};
document.getElementById("parentTrigger").ontouchend=()=>clearTimeout(timer);
function openParent(){
  document.getElementById("parentPanel").style.display="block";
  document.getElementById("pLevel").textContent=level;
  document.getElementById("pTotal").textContent=totalCount;
}
function closeParent(){
  document.getElementById("parentPanel").style.display="none";
}
function resetAll(){
  if(confirm("ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ")){
    localStorage.clear();
    location.reload();
  }
}

/* ===== é–‹å§‹ ===== */
loadGame();
startLevel();
</script>

</body>
</html>
