<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Spelling Dragon Battle</title>

<style>
body{
  font-family:"Arial Rounded MT Bold",Arial,sans-serif;
  background:linear-gradient(#dff3ff,#ffffff);
  text-align:center;
  margin:0;
  padding:12px;
}

h1{
  font-size:42px;
  color:#2b6cb0;
  margin:10px 0;
}

.level{font-size:30px;}
.dragon{font-size:100px;margin:10px 0;}

/* é€²æ—ãƒãƒ¼ */
.hp-bar{
  width:340px;height:28px;
  background:#ddd;border-radius:20px;
  margin:12px auto;overflow:hidden;
}
#hpFill{
  height:100%;width:0%;
  background:linear-gradient(to right,#4caf50,#8bc34a);
  transition:.3s;
}

/* ãƒ¡ã‚¤ãƒ³ãƒœã‚¿ãƒ³ */
.listen-btn{
  font-size:42px;
  padding:28px 64px;
  margin:12px;
  border-radius:32px;
  background:#ff9800;
  color:white;border:none;
}
.listen-btn:active{background:#f57c00;}

.hint-btn{
  font-size:36px;
  padding:24px 56px;
  margin:12px;
  border-radius:30px;
  background:#9c27b0;
  color:white;border:none;
}
.hint-btn:active{background:#7b1fa2;}

#hint{
  font-size:44px;
  height:50px;
  color:#444;
}

.progress{
  font-size:42px;
  color:#2e7d32;
  min-height:48px;
}

/* ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆ */
.buttons button{
  font-size:52px;
  width:120px;height:120px;
  margin:10px;
  border-radius:30px;
  border:none;
  background:#4cafef;
  color:white;
  box-shadow:0 5px 0 #2196f3;
}
.buttons button:active{
  transform:translateY(5px);
  box-shadow:none;
}

/* ã‚¹ãƒ†ãƒƒã‚«ãƒ¼ */
#stickerArea{
  display:flex;flex-wrap:wrap;
  justify-content:center;
  gap:14px;margin-top:14px;
}
#stickerArea img{
  width:100px;border-radius:16px;
  box-shadow:0 4px 8px rgba(0,0,0,.25);
}

/* æ‹¡å¤§ */
#modal{
  display:none;position:fixed;inset:0;
  background:rgba(0,0,0,.7);
  justify-content:center;align-items:center;
  z-index:2000;
}
#modal img{
  width:380px;
  background:white;
  border-radius:26px;
  padding:14px;
}

/* ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ— */
#levelUpEffect{
  display:none;position:fixed;inset:0;
  background:rgba(255,255,255,.92);
  z-index:5000;
  justify-content:center;align-items:center;
  flex-direction:column;
}
.level-text{
  font-size:60px;
  color:#ff9800;
  font-weight:bold;
}
.sparkles{
  font-size:48px;
  margin-top:12px;
}

/* ãƒªã‚»ãƒƒãƒˆ */
#resetArea{
  margin-top:30px;
  padding-bottom:20px;
}
#resetBtn{
  font-size:20px;
  padding:14px 30px;
  border-radius:18px;
  background:#dddddd;
  color:#333;border:none;
}
#resetHint{
  font-size:14px;
  color:#666;
  margin-top:6px;
}
</style>
</head>

<body>

<h1>ğŸ‰ ã‚¹ãƒšãƒªãƒ³ã‚° ãƒ‰ãƒ©ã‚´ãƒ³ãƒãƒˆãƒ«</h1>
<div class="level">LEVEL <span id="level">1</span></div>
<div class="dragon">ğŸ²</div>

<div class="hp-bar"><div id="hpFill"></div></div>

<button class="listen-btn" onclick="speakWord()">ğŸ”Š ãã</button>
<button class="hint-btn" onclick="showHint()">ğŸ’¡ HINT</button>

<div id="hint"></div>
<div class="progress" id="progress"></div>
<div class="buttons" id="buttons"></div>

<h2>ğŸ ã‚¹ãƒ†ãƒƒã‚«ãƒ¼</h2>
<div id="stickerArea"></div>

<!-- ã‚¹ãƒ†ãƒƒã‚«ãƒ¼æ‹¡å¤§ -->
<div id="modal" onclick="closeModal()">
  <img id="modalImg">
</div>

<!-- ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—æ¼”å‡º -->
<div id="levelUpEffect">
  <div class="level-text">LEVEL UP!! â­</div>
  <div class="sparkles">âœ¨ â­ âœ¨ â­ âœ¨</div>
</div>

<!-- 3ç§’é•·æŠ¼ã—ãƒªã‚»ãƒƒãƒˆ -->
<div id="resetArea">
  <button id="resetBtn"
    ontouchstart="startReset()"
    ontouchend="cancelReset()"
    onmousedown="startReset()"
    onmouseup="cancelReset()"
    onmouseleave="cancelReset()">
    ğŸ”„ ã•ã„ã—ã‚‡ã‹ã‚‰
  </button>
  <div id="resetHint">â€»3ã³ã‚‡ã† ãªãŒãŠã—</div>
</div>

<script>
/* ===== åŠ¹æœéŸ³ ===== */
const hitSound  = new Audio("hit.mp3");
const missSound = new Audio("miss.mp3");
const deadSound = new Audio("dead.mp3");

/* ===== éŸ³å£°åˆæœŸåŒ–ï¼ˆiPadå¯¾ç­–ï¼‰ ===== */
window.speechSynthesis.onvoiceschanged = () => {
  speechSynthesis.getVoices();
};

/* ===== å˜èª ===== */
let words=[
// åŸºæœ¬ã‚ˆãä½¿ã†å˜èª
  "THE","A","DO","TO","OF","SAID","SAYS","YOU","YOUR","THEY",
  "BE","ME","HE","SHE","WE","NO",

  // å‹•ä½œãƒ»å­¦æ ¡ãƒ»äºº
  "COME","SOME","ONE","ONCE","ASK","FRIEND","SCHOOL","PUT",
  "ARE","WERE","WAS","HIS","HAS","I",

  // å ´æ‰€ãƒ»æ–¹å‘ãƒ»èº«è¿‘ãªã‚‚ã®
  "GO","SO","BY","MY","HERE","THERE","WHERE","LOVE","PUSH","PULL",
  "HOUSE","FULL","OUR","DOOR","POOR","FIND",

  // çŠ¶æ…‹ãƒ»å½¢å®¹ãƒ»ç†ç”±
  "MIND","FLOOR","BECAUSE","KIND","BEHIND","WHOLE","WHY","ANY",
  "CHILD","CHILDREN","CLIMB","ONLY","OLD","MANY",

  // å½¢å®¹è©ãƒ»ã‚ˆãä½¿ã†èª
  "CLOTHES","COLD","GOLD","HOLD","TOLD","EVERY","GREAT","BREAK",
  "STEAK","BUSY","PEOPLE","PRETTY","BEAUTIFUL","AFTER","FAST","LAST",

  // æ™‚é–“ãƒ»ç”Ÿæ´»
  "PAST","FATHER","CLASS","WATER","AGAIN","GRASS","PASS","PLANT",
  "PATH","BATH","HOUR","MOVE","PROVE","HALF","MONEY","IMPROVE",

  // ãã®ã»ã‹ï¼ˆã‚ˆãå‡ºã‚‹èªï¼‰
  "SUGAR","COULD","WOULD","SURE","EYE","SHOULD","WHO",
  "MR","MRS","PARENTS","CHRISTMAS","EVERYBODY","EVEN"
].map(w=>w.toUpperCase());

let level=1;
let levelWords=[],qIndex=0;
let currentWord="",charIndex=0;
let stickers=[];

/* ===== è‹±å›½ç™ºéŸ³å„ªå…ˆ ===== */
function speakWord(){
  speechSynthesis.cancel();
  const u=new SpeechSynthesisUtterance(currentWord);
  u.rate=0.9;

  const voices=speechSynthesis.getVoices();
  let voice=
    voices.find(v=>v.lang==="en-GB") ||
    voices.find(v=>v.lang.startsWith("en-GB")) ||
    voices.find(v=>v.lang==="en-US") ||
    voices.find(v=>v.lang.startsWith("en-US")) ||
    voices.find(v=>v.lang.startsWith("en"));

  if(voice){u.voice=voice;u.lang=voice.lang;}
  else{u.lang="en-GB";}

  speechSynthesis.speak(u);
}

/* ===== HINT ===== */
function showHint(){
  const h=document.getElementById("hint");
  h.textContent=currentWord;
  setTimeout(()=>h.textContent="",1000);
}

/* ===== ãƒ¬ãƒ™ãƒ«å‡¦ç† ===== */
function startLevel(){
  levelWords=[...words].sort(()=>Math.random()-0.5).slice(0,10);
  qIndex=0;
  startQuestion();
}

function startQuestion(){
  currentWord=levelWords[qIndex];
  charIndex=0;
  document.getElementById("progress").textContent="";
  updateProgress();
  createButtons();
  setTimeout(speakWord,500);
}

/* ===== ãƒœã‚¿ãƒ³ç”Ÿæˆ ===== */
function createButtons(){
  const area=document.getElementById("buttons");
  area.innerHTML="";
  let letters=currentWord.split("");
  while(letters.length<8){
    const c=String.fromCharCode(65+Math.floor(Math.random()*26));
    if(!letters.includes(c)) letters.push(c);
  }
  letters.sort(()=>Math.random()-0.5);
  letters.forEach(l=>{
    const b=document.createElement("button");
    b.textContent=l;
    b.onclick=()=>tapLetter(l);
    area.appendChild(b);
  });
}

/* ===== åˆ¤å®š ===== */
function tapLetter(l){
  if(l===currentWord[charIndex]){
    hitSound.currentTime=0;hitSound.play();
    charIndex++;
    document.getElementById("progress").textContent=
      currentWord.slice(0,charIndex);

    if(charIndex===currentWord.length){
      qIndex++;
      updateProgress();
      if(qIndex>=10){
        deadSound.currentTime=0;deadSound.play();
        levelUp();
      }else{
        startQuestion();
      }
    }
  }else{
    missSound.currentTime=0;missSound.play();
  }
}

/* ===== é€²æ— ===== */
function updateProgress(){
  document.getElementById("hpFill").style.width=(qIndex/10*100)+"%";
}

/* ===== ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ— ===== */
function showLevelUpEffect(){
  const e=document.getElementById("levelUpEffect");
  e.style.display="flex";
  setTimeout(()=>e.style.display="none",1500);
}
function levelUp(){
  level++;
  document.getElementById("level").textContent=level;
  showLevelUpEffect();
  addSticker(Math.floor(Math.random()*50)+1);
  setTimeout(startLevel,1500);
}

/* ===== ã‚¹ãƒ†ãƒƒã‚«ãƒ¼ ===== */
function addSticker(n){
  stickers.push(n);
  const img=document.createElement("img");
  img.src=`volst (${n}).png`;
  img.onclick=()=>openModal(img.src);
  document.getElementById("stickerArea").appendChild(img);
}
function openModal(src){
  document.getElementById("modalImg").src=src;
  document.getElementById("modal").style.display="flex";
}
function closeModal(){
  document.getElementById("modal").style.display="none";
}

/* ===== 3ç§’é•·æŠ¼ã—ãƒªã‚»ãƒƒãƒˆ ===== */
let resetTimer=null;
function startReset(){
  resetTimer=setTimeout(resetAll,3000);
}
function cancelReset(){
  if(resetTimer){clearTimeout(resetTimer);resetTimer=null;}
}
function resetAll(){
  cancelReset();
  if(confirm("ã•ã„ã—ã‚‡ã‹ã‚‰ ã‚„ã‚ŠãªãŠã—ã¾ã™ã‹ï¼Ÿ")){
    localStorage.clear();
    location.reload();
  }
}

/* ===== é–‹å§‹ ===== */
startLevel();
</script>

</body>
</html>
